---
title: "Potential Hydrochemographs"
author: "LAR"
date: "4/22/2022"
output: html_document
---

```{r setup, echo = FALSE, warning= FALSE, message = FALSE, include=FALSE}
#hydrochemographs :) 

#call function
source("C:/Users/linne/Downloads/PhD_Code/EcosysGCBClass2022/Hydro_Chemo_Graphs/Code/Functions/chemo_hydrograph.R")

library(tidyverse)
library(lubridate)


### potential hydrochemographs from Green Lake 4 ###
# call data and format
source("C:/Users/linne/Downloads/PhD_Code/EcosysGCBClass2022/Hydro_Chemo_Graphs/Data/Call_Data.R") 
Gl4stoich <- Gl4Chem |>
 # mutate(tntp = as.numeric(TN)/as.numeric(TP)) |>
  mutate(tdn.tdp = as.numeric(TDN)/as.numeric(TDP),
         don.dop = as.numeric(DON)/as.numeric(DOP)) |>
  filter(year!= 2014)

p1 <- chemo_hydrograph(Gl4stoich, Gl4stoich$don.dop, "DON:DOP (molar ratio)", Gl4Dis)
p2 <- chemo_hydrograph(Gl4stoich, Gl4stoich$tdn.tdp, "TDN:TDP (molar ratio)", Gl4Dis) # use
p3 <- chemo_hydrograph(Gl4Chem, Gl4Chem$NH4., "Ammonium"~(mu~eq~L^-1), Gl4Dis)
p4 <- chemo_hydrograph(Gl4Chem, Gl4Chem$NO3., "Nitrate"~(mu~eq~L^-1), Gl4Dis) # use
p5 <- chemo_hydrograph(Gl4Chem, Gl4Chem$TDN, "Total Dissolved N"~(mu~mol~L^-1), Gl4Dis)
p6 <- chemo_hydrograph(Gl4Chem, Gl4Chem$DON, "Dissolved Organic N"~(mu~mol~L^-1), Gl4Dis)
p7 <- chemo_hydrograph(Gl4Chem, Gl4Chem$IN, "Inorganic N"~(mu~eq~L^-1), Gl4Dis)
p8 <- chemo_hydrograph(Gl4Chem, Gl4Chem$TDP, "Total Dissolved P"~(mu~mol~L^-1), Gl4Dis)
p9 <- chemo_hydrograph(Gl4Chem, Gl4Chem$DOP, "Dissolved Organic P"~(mu~mol~L^-1), Gl4Dis)

### potential hydrochemogrpahs from Loch Vale outlet ###
# call data and format
lochvale <- read.csv("C:/Users/linne/Downloads/PhD_Code/EcosysGCBClass2022/Hydro_Chemo_Graphs/Data/USGS_lochvaleoutlet.csv") |>
 select(-X, -X.1) |>
  mutate(Date = as.Date(Date)) |>
  rename(date = Date)  |>
  filter(year(date) > 1995)

p10 <- chemo_hydrograph(lochvale, lochvale$no3.po4, "NO3:PO4 (molar ratio)", lochvale)
p11 <- chemo_hydrograph(lochvale, lochvale$Nitrate_mgl, "Nitrate"~(mg~~L^-1), lochvale) # use
p12 <- chemo_hydrograph(lochvale, lochvale$Phosphate_mgl, "Phosphate"~(mg~~L^-1), lochvale)

```


```{r setup, echo = FALSE, warning= FALSE, message = FALSE, include=FALSE}

# water year graphs
source("C:/Users/linne/Downloads/PhD_Code/EcosysGCBClass2022/Hydro_Chemo_Graphs/Code/Functions/chemo_hydrograph.R")

### Green Lake 4 ###
p13 <- wateryearplot(Gl4stoich, Gl4stoich$tdn.tdp, "TDN:TDP (molar ratio)")
p14 <- wateryearplot(Gl4Dis, Gl4Dis$discharge_rate, "Streamflow" ~ (m ^ 3 ~ s ^ -1))
p15 <- wateryearplot(Gl4stoich, Gl4stoich$NO3., "Nitrate"~(mu~eq~L^-1))

### Loch Vale ###
p16 <- wateryearplot(lochvale, lochvale$Nitrate_mgl, "Nitrate"~(mg~L~L^-1))
p17 <- wateryearplot(lochvale,lochvale$discharge_rate, "Streamflow" ~ (m ^ 3 ~ s ^ -1))

```


```{r}
# Make a graph of Green Lake 4 TDN and TDP data 
# modifying code from chemo_hydrograph function
 
 # chemData.1 <- Gl4Chem |>
 #    mutate(chemVar = as.numeric(TDN)) |>
 #    filter(!is.na(chemVar))|>
 #    filter(chemVar != Inf)
 #  
 #  
 #  mindate <- min(chemData.1$date)
 #  maxdate <- max(chemData.1$date)
 #  
 #  coef <- mean(as.numeric(chemData.1$chemVar), na.rm = TRUE) / mean(disData$discharge_rate, na.rm = TRUE)
 #  
 #  
 #  ggplot() +
 #    geom_line(disData, mapping = aes(date, discharge_rate * coef), color = "#9A9391") +
 #    geom_line(chemData.1, mapping = aes(date, chemVar), color = "#d14411") +
 #    theme_light() +
 #    scale_x_date(limits = c(mindate, maxdate)) +
 #    labs(x = "") +
 #    scale_y_continuous(
 #      # first axis
 #      name = name_units,
 #      
 #      # second axis 
 #      sec.axis = sec_axis(~./coef, name = "Streamflow" ~ (m ^ 3 ~ s ^ -1))
 #    )  +
 #    theme(axis.title.y.right = element_text(color = "#9A9391"),
 #          axis.title.y = element_text(color = "#d14411"),
 #          axis.line.y.left = element_line(color = "#d14411")) 

```

## Niwot Ridge LTER 
These data are from the stream outlet of Green Lake 4. The winter chemistry data is collected beneath the ice in the lake. During 2014, the discharge data deviates from the other streams and the typical seasonal pattern. The lead technician for Niwot Ridge LTER reported nothing obvious on the ground that would casue an error. So it is possible that the discharge data from 2014 are either real or there could have been some sort of sensor issue. 

### Hydrochemographs!!!
Stoichiometric timeseries if we decide we want to use any of these
```{r, echo=FALSE, warning=FALSE, message=FALSE}
p2
```

Here is the nitrate hydrochemograph. Note the units are the worst possible units anyone could provide with data. 
```{r, echo=FALSE, warning=FALSE, message=FALSE}
p4
```

## Loch Vale 
These data are from the stream outlet of Loch Vale and were downloaded from USGS using the dataReterieval package in R (De Cicco et al., 2021). 

### More beautiful hydrochemographs!!!
We have good nitrate data to create hydrochemographs from this site. Here is the nitrate hydrochemograph. Phosphate data were often below detection limit :( 
```{r, echo=FALSE, warning=FALSE, message=FALSE}
p11
```


```{r, echo=FALSE, warning=FALSE, message=FALSE}

```


## Data Sources
Caine, N., J. Morse, and Niwot Ridge LTER. 2022. Streamflow for Green Lake 4, 1981 - ongoing. ver 15. Environmental Data Initiative. https://doi.org/10.6073/pasta/ff6f7947279eeeeca851baed6cd6f41a (Accessed 2022-04-22).

Caine, T. 2021. Stream water chemistry data for Green Lake 4, 1982 - ongoing. ver 12. Environmental Data Initiative. https://doi.org/10.6073/pasta/277121f0334757746d9d52ce2c2e82ab (Accessed 2022-04-22).

De Cicco, L.A., Hirsch, R.M., Lorenz, D., Watkins, W.D., 2021, dataRetrieval: R packages for discovering
and retrieving water data available from Federal hydrologic web services, doi:10.5066/P9X4L3GE

"Logistical support and/or data were provided by the USGS supported Loch Vale Watershed Long-term Ecological Research and Monitoring program and Colorado State University."